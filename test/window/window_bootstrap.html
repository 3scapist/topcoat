<!doctype html>
<html>
<head>
	<meta http-equiv=content-type content=text/html;charset=utf-8>
	<meta name=viewport content=width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1>
	<title>Index</title>
	<link rel="stylesheet" type="text/css" href="../bootstrap/css/bootstrap.min.css">
</head>
<body>
<div class="navbar navbar-inverse navbar-fixed-top">
	<div class="navbar-inner">
		<div class="container">
			<a href="#" class="brand">Thinskin</a>
		</div>
	</div>
</div>

<table class="table table-striped">
	<tbody></tbody>
</table>

<script type="text/javascript" src="../js/benchmark.js"></script>
<script type="text/javascript" src="../js/BrowserDetect.js"></script>

<script type="text/javascript">
	var output = document.querySelector('.brand');
	var table = document.querySelector('tbody');
	var benchmark = new Benchmark.Suite('thinskin', {
		onStart: function () {
			if(self.opener) {
				self.opener.popup = self;
			} else {
				alert('This test should be runned from the index.html page')
			}
		}
	});

	benchmark.add('insert tr/td (with bootstrap)', function() {
		var tr = document.createElement('tr');
		var td = document.createElement('td');
		td.innerHTML = 'some info here';
		tr.appendChild(td);
		table.appendChild(tr);
	})
	.on('cycle', function(event) {
		sendBenchmark(String(event.target));
		if(self.opener) {
			self.opener.appendOutput(String(event.target), '#bootstrap');
			self.opener.suite.add(event.target);
			self.opener.launchTest();
		} else {
			alert(String(event.target));
		}
	});

	benchmark.run({'async':true});

	function sendBenchmark(benchtest) {
    
    var formData = new FormData();
    formData.append('benchmark_result', benchtest);
    formData.append('os', BrowserDetect.OS);
    formData.append('version', BrowserDetect.version);
    formData.append('browser', BrowserDetect.browser);
    
        var xhr = new XMLHttpRequest();
        xhr.open('POST', 'http://topcoat.jit.su/benchmark', true);
        xhr.responseType = 'text';
        xhr.onload = function(e) {
            if (this.status == 200) {
                console.log(this.response);
            }
        };
        xhr.send(formData);
    }
</script>
</body>
</html>